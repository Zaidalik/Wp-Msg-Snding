<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Custom Message</title>
    <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Modak&family=Raleway:ital,wght@0,100..900;1,100..900&family=Sniglet:wght@400;800&display=swap" rel="stylesheet">

    <link href="https://fonts.googleapis.com/css2?family=Raleway:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
      
  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Inter:wght@100;200;300;400;500;600;700;800;900&family=Barlow:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Bootstrap Icons -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

<!-- Glightbox CSS -->
<link href="https://cdn.jsdelivr.net/npm/glightbox/dist/css/glightbox.min.css" rel="stylesheet">

<!-- Swiper CSS -->
<link href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="/main.css" rel="stylesheet">
  <style>
    body {
      background-color: #ece5dd;
      font-family: 'Raleway', sans-serif;
    }

    h2, h3 {
      color: #075e54;
    }

    .card {
      background-color: #dcf8c6;
      border: 2px solid #25d366;
    }

    .form-control, .form-select {
      background-color: #fff;
      border: 1px solid #25d366;
    }

    .btn-success {
      background-color: #25d366;
      border-color: #25d366;
    }

    .btn-success:hover {
      background-color: #1da851;
      border-color: #1da851;
    }

    #message-preview {
      background-color: #fefefe;
      border-color: #25d366;
      white-space: pre-wrap;
    }

    .container-m {
        padding-top: 100px !important;
      padding-bottom: 150px; /* Prevent touching footer */
    }
  </style>
</head>
<body>

<header id="header" class="header fixed-top">
  <div class="branding d-flex align-items-center">
    <div class="container position-relative d-flex align-items-center justify-content-between">
      <div class="logo-wrapper" style="display: flex; flex-direction: column; align-items: flex-start;">
        <a href="dashboard.html" class="logo d-flex align-items-center">
          <img src="./assets/img/wazapLogo-removebg-preview.png" alt="Wazap Logo" style="max-height: 100px; width: auto; object-fit: contain;">
        </a>
      </div>
      <nav id="navmenu" class="navmenu">
        <ul>
          <li><a href="/dashboard">Dashboard</a></li>
          <li><a href="/qr.html">ConnectDevice</a></li>
          <li><a href="/customMessage.html">customMessage</a></li>
          <li><a href="#team">Team</a></li>
          <li><a href="/app-logout">Logout</a></li>
        </ul>
        <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
      </nav>
    </div>
  </div>
</header>

<div class="container container-m mt-5 pt-5 d-flex flex-column align-items-center">

  <h2 class="text-center mb-4 sniglet-extrabold">üõ†Ô∏è Customize WhatsApp Message</h2>

  <div class="card shadow p-4 w-100" style="max-width: 700px;">
    <form id="custom-message-form" class="d-flex flex-column">
      <div class="mb-3">
        <label for="insert-field" class="form-label">Insert Field:</label>
        <select id="insert-field" class="form-select">
          <option value="">-- Select --</option>
          <option value="{firstName}">First Name</option>
          <option value="{lastName}">Last Name</option>
          <option value="{fullName}">Full Name</option>
          <option value="{orderNumber}">Order Number</option>
          <option value="{totalPrice}">Total Price</option>
          <option value="{currency}">Currency</option>
          <option value="{rawPhone}">Phone</option>
          <option value="{fullAddress}">Full Address</option>
          <option value="{supportNumber}">Support Number</option>
        </select>
      </div>

      <div class="mb-3">
        <label for="message-input" class="form-label">Message Template:</label>
        <textarea id="message-input" class="form-control" rows="6" placeholder="Type your message here..."></textarea>
      </div>

      <div class="mb-3 text-end">
        <button type="submit" class="btn btn-success">üíæ Save Message</button>
      </div>
    </form>
  </div>

  <div class="mt-4 w-100" style="max-width: 700px;">
    <h3 class="text-center mb-2">üìÑ Live Preview</h3>
    <pre id="message-preview" class="p-3 rounded border"></pre>
  </div>
</div>
  <footer id="footer" class="footer position-relative dark-background">

    <div class="container footer-top">
      <div class="row gy-4">
        <div class="col-lg-5 col-md-12 footer-about">
           <a href="index.html" class="logo d-flex align-items-center" style="height: auto;">
      <img src="./assets/img/wazapLogo_White.png" 
     alt="Wazap Logo"
     style="max-height: 100px; width: auto; object-fit: contain; display: block;">
      </a>
          <p>What started as a small experiment to simplify digital messaging has evolved into a reliable tool trusted by teams and businesses to connect with their audience ‚Äî securely and efficiently.</p>
          <div class="social-links d-flex mt-4">
            <a href=""><i class="bi bi-twitter-x"></i></a>
            <a href=""><i class="bi bi-facebook"></i></a>
            <a href=""><i class="bi bi-instagram"></i></a>
            <a href=""><i class="bi bi-linkedin"></i></a>
          </div>
        </div>

        <div class="col-lg-2 col-6 footer-links">
          <h4>Useful Links</h4>
          <ul>
            <li><a href="#">Home</a></li>
            <li><a href="#">About us</a></li>
            <li><a href="#">Services</a></li>
            <li><a href="#">Terms of service</a></li>
            <li><a href="#">Privacy policy</a></li>
          </ul>
        </div>

       
        <div class="col-lg-3 col-md-12 footer-contact text-center text-md-start">
          <h4>Contact Us</h4>
          <p>Karachi , Pakistan</p>
          <p class="mt-4"><strong>Phone :</strong> <span>+92 331 1346979</span></p>
          <p><strong>Personal Email :</strong> <span>zaidaliper@gmail.com</span></p>
        </div>

      </div>
    </div>

    <div class="container copyright text-center mt-4">
      <p>¬© <span>Copyright</span> <strong class="px-1 sitename">WAZAP</strong> <span>All Rights Reserved</span></p>
      <div class="credits">
          Designed by <a href="https://www.linkedin.com/in/zaid-ali-dev" target="_blank">Zaid Ali Khan</a>

      </div>
    </div>

  </footer>


<script>
window.addEventListener('DOMContentLoaded', () => {
  const fieldSelect = document.getElementById('insert-field');
  const messageInput = document.getElementById('message-input');
  const preview = document.getElementById('message-preview');

  const sampleData = {
    firstName: "Ali",
    lastName: "Khan",
    fullName: "Ali Khan",
    orderNumber: "12345",
    totalPrice: "1500",
    currency: "PKR",
    rawPhone: "03001234567",
    fullAddress: "123 Street Name\nCity, Country",
    supportNumber: "03273627796"
  };

  // Load saved message
  fetch('/api/custom-message')
    .then(res => res.json())
    .then(data => {
      if (data.message) {
        messageInput.value = data.message;
        updatePreview();
      }
    })
    .catch(err => {
      console.error('‚ùå Error loading saved message:', err);
    });

  // Load user info
  fetch('/api/user-info')
    .then(res => res.json())
    .then(data => {
      document.getElementById('username').textContent = data.username;
      document.getElementById('credits').textContent = data.credits;
    })
    .catch(err => {
      console.error('‚ùå Failed to load user info', err);
    });

  // Insert placeholder when field selected
  fieldSelect.addEventListener('change', () => {
    const value = fieldSelect.value;
    if (value) {
      const start = messageInput.selectionStart;
      const end = messageInput.selectionEnd;
      const text = messageInput.value;
      messageInput.value = text.slice(0, start) + value + text.slice(end);
      fieldSelect.value = ''; // reset
      updatePreview();
    }
  });

  messageInput.addEventListener('input', updatePreview);

  function updatePreview() {
    let msg = messageInput.value;
    const sortedEntries = Object.entries(sampleData).sort((a, b) => b[0].length - a[0].length);
    sortedEntries.forEach(([key, val]) => {
      const regex = new RegExp(`{${key}}`, 'g');
      msg = msg.replace(regex, val);
    });
    preview.textContent = msg;
  }

  // Submit and save message
  document.getElementById('custom-message-form').addEventListener('submit', function(e) {
    e.preventDefault();
    const message = messageInput.value;

    fetch('/save-message', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ message })
    })
    .then(res => res.text())
    .then(data => {
      alert(data);
    })
    .catch(err => {
      console.error('‚ùå Error saving message:', err);
      alert('‚ùå Failed to save message.');
    });
  });

  // Show initial preview
  updatePreview();
});

    window.addEventListener("scroll", function () {
    const header = document.querySelector("#header");
    if (window.scrollY > 50) {
      header.classList.add("scrolled");
    } else {
      header.classList.remove("scrolled");
    }
  });
</script>
<a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="assets/vendor/imagesloaded/imagesloaded.pkgd.min.js"></script>
  <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>

  <!-- Main JS File -->
  <script src="assets/js/main.js"></script>


</body>
</html>
