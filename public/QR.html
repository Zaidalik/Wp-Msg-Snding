<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WhatsApp QR Code</title>
    <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Modak&family=Raleway:ital,wght@0,100..900;1,100..900&family=Sniglet:wght@400;800&display=swap" rel="stylesheet">

    <link href="https://fonts.googleapis.com/css2?family=Raleway:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
</head>
<style>
    body {
        margin: 0;
        padding: 0;
        height: 100vh;
        background: linear-gradient(to bottom right, #33ccff, #ff99ff);
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
        overflow: hidden;
    }

        /* Add a pseudo-element for animated gradient overlay */
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom right, #ff99ff, #33ccff);
            animation: fadeGradient 4s infinite alternate;
            opacity: 0;
            z-index: -1;
        }

    @keyframes fadeGradient {
        0% {
            opacity: 0;
        }

        100% {
            opacity: 1;
        }
    }

    .data {
        position: relative;
        z-index: 1;
        padding: 2rem;
        border-radius: 1rem;
        background: rgba(255, 255, 255, 0.1);
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        transition: 0.5s;
        backdrop-filter: blur(10px); /* Optional: gives frosted glass effect */
    }
        .data:hover {
            box-shadow: 0px 0px 40px 0px grey;
        }
    #qrcode {
        border-radius: 1rem; /* or try 10px */
        overflow: hidden; /* ensures QR image doesn't overflow the rounded corners */
    }
    .circle {
        position: absolute;
        width: 400px;
        height: 400px;
        background: #e0e0e0; /* Light gray or your preferred color */
        border-radius: 50%;
        margin: 0px 450px 200px 20px;
        animation: floatUpDown 4s ease-in-out infinite;
        z-index: 0; /* behind the content */
    }
    .circle2 {
        position: absolute;
        width: 400px;
        height: 400px;
        background: #e0e0e0; /* Light gray or your preferred color */
        border-radius: 50%;
        margin: 300px 20px 20px 450px;
        animation: floatDownUp 4s ease-in-out infinite;
        z-index: 0; /* behind the content */
    }
    @keyframes floatUpDown {
        0% {
            transform: translateY(0);
        }

        50% {
            transform: translateY(-20px);
        }

        100% {
            transform: translateY(0);
        }
    }

    @keyframes floatDownUp {
        0% {
            transform: translateY(0);
        }

        50% {
            transform: translateY(20px);
        }

        100% {
            transform: translateY(0);
        }
    }

    .container {
        position: relative;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
    }
    .logout {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        padding: 10px 20px;
        border-radius: 20px;
        color: BLACK;
        transition:0.5S;
        border: 1px solid BLACK;
    }
        .logout:HOVER {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 10px 20px;
            border-radius: 20px;
            box-shadow: 0 0 20px white;
            color: white;
            border: 1px solid white;
        }
    .navbar {
        position: absolute;
        top: 0;
        width: 100%;
        padding: 15px 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        color: white;
        z-index: 10;
    }
    .sniglet-regular {
        font-family: "Sniglet", system-ui;
        font-weight: 400;
        font-style: normal;
    }

    .sniglet-extrabold {
        font-family: "Sniglet", system-ui;
        font-weight: 800;
        font-size:100px;
        font-style: normal;
    }


    .navbar-logo {
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        font-size: 1.5rem;
        font-weight: bold;
        white-space: nowrap;
    }

    .navbar-links {
        list-style: none;
        display: flex;
        gap: 20px;
        margin: 0;
        padding: 0;
        margin-left: auto;
    }

        .navbar-links li a {
            text-decoration: none;
            color: white;
            font-weight: 500;
            transition: color 0.3s ease;
        }

            .navbar-links li a:hover {
                color: #ffff99;
            }

    .head {
        font-size: 20px;
        font-family: "Sniglet", system-ui;
        font-weight: 400;
        font-style: normal;
    }
</style>

<body>
    <nav class="navbar">
        <p class="head">
            Welcome,  &nbsp <span id="username">...  </span>  &nbsp  | 💰 Credits: <span id="credits">...</span>
        </p>
            <div class="spacer "></div> <!-- Empty spacer to balance the layout -->
            <div class="navbar-logo sniglet-extrabold ">WhatsApp Sender</div>
            <ul class="navbar-links  ">
                <li><a href="/qr.html">QR Code</a></li>
                 <li><a href="/customMessage.html">customMessage</a></li>
                <li><a href="/send">Send Message</a></li>
                <li><a href="/app-logout">Logout</a></li>
            </ul>

    </nav>
    
        
    </nav>

    <div class="container">
        <div class="circle"></div>
        <div class="circle2"></div>

        <div class="text-center data text-LIGHT">
            <h2 class="raleway-uniquifier">Scan the QR Code with WhatsApp</h2>
<!-- 🔗 Send Message URL -->
<div class="mt-3 mb-3">
    <p>Your Order Confirmation URL :</p>
    <code id="send-url" style="background: rgba(0,0,0,0.1); padding: 10px; border-radius: 5px; display: inline-block;"></code>
</div>
            <div id="qrcode" class="mt-3">Loading QR code...</div>
<div id="message-preview-section">
            <!-- ✅ Logout button placed normally below the QR -->
            <div style="margin-top: 2rem;">
                <form action="/logout" method="get">
                    <button type="submit" class="logout raleway-uniquifier">
                        LOGOUT
                    </button>
                </form>
            </div>
        </div>
    </div>



    </div>
    <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
    <script>
        async function fetchQR() {
            try {
                const res = await fetch('/api/qr');
                const data = await res.json();

                const qrContainer = document.getElementById('qrcode');
                qrContainer.innerHTML = ''; // Clear previous content

                if (data.connected) {
                    // WhatsApp is connected, show connected message
                    qrContainer.textContent = '✅ Device Connected.';
                } else if (data.qr) {
                    // Show QR code canvas
                    QRCode.toCanvas(data.qr, { width: 256 }, function (err, canvas) {
                        if (err) {
                            console.error(err);
                            qrContainer.textContent = '❌ Error generating QR code.';
                            return;
                        }
                        qrContainer.appendChild(canvas);
                    });
                } else {
                    // No QR and not connected => waiting for QR
                    qrContainer.textContent = '⏳ Waiting for QR code...';
                }
            } catch (err) {
                document.getElementById('qrcode').textContent = '❌ Error loading QR.';
                console.error(err);
            }
        }

        fetchQR();
        setInterval(fetchQR, 5000); // Refresh every 5 seconds in case it updates

        //-------------------------------------------------CREDIT SHOWING CODE ----------------------------------------------------------------------

            fetch('/api/user-info')
      .then(res => res.json())
      .then(data => {
                document.getElementById('username').textContent = data.username;
            document.getElementById('credits').textContent = data.credits;
      })
      .catch(err => {
                console.error('❌ Failed to load user info', err);
      });
// Set Send URL above QR
fetch('/api/user-info')
    .then(res => res.json())
    .then(data => {
        document.getElementById('username').textContent = data.username;
        document.getElementById('credits').textContent = data.credits;

        // 💡 Show Send URL using user ID
        const sendUrlElement = document.getElementById('send-url');
        sendUrlElement.textContent = `${window.location.origin}/send/${data.userId || 'yourUserId'}`;
    })
    .catch(err => {
        console.error('❌ Failed to load user info', err);
    });



    </script>


</body>
</html>
